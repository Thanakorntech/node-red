[{"id":"c4c76af7.3b3898","type":"function","name":"âˆ‘ (MeterEvents)","func":"var EventType = msg.topic.split(\"/\").pop();\n\nif (EventType != \"meterevent\")\n{\n\treturn [null,EventType];\n}\n\n//Save previous events. \ncontext.lastevents = context.lastevents || {}; \npayload = JSON.parse(msg.payload);\ncontext.lastevents[msg.topic] = payload;\n\nvar sum_power=0;\nvar sum_energy=0;\n\nfor (var topic in context.lastevents) {\n    if (context.lastevents.hasOwnProperty(topic)) {\n    \tif (topic[0] != \"_\") \n    \t{\n        \tsum_power+=context.lastevents[topic][\"power\"];\n        \tsum_energy+=context.lastevents[topic][\"energy\"];\n        }\n    }\n}\n \n\nnewpayload = {\"time\":payload.ts,\"power\":sum_power,\"energy\":sum_energy};\n\nmsg.payload = JSON.stringify(newpayload)\nmsg.topic = \"sum/meterevent\"\n\nreturn [msg,context.table];","outputs":"2","x":349,"y":101,"z":"716249cc.8e9db8","wires":[[],[]]}]