[{"id":"2e582d25.d1a7d2","type":"http request","name":"Send to Influx","method":"POST","ret":"txt","url":"","x":546,"y":451,"z":"716249cc.8e9db8","wires":[[]]},{"id":"1b445b48.e4bba5","type":"function","name":"Format data for influx","func":"\nmsg.topic = msg.topic || \"No topic\";\n\nmsg.url = \"http://localhost:8086/db/1week/series?u=root&p=root\"\n\n//Is json?\nif (typeof msg.payload == \"string\" && msg.payload.indexOf(\"{\") > -1)\n{\n   var json = JSON.parse(msg.payload);\n  \n}\nelse\n{\n   //var topic = str.split('/');\n   //var lasttopic = topic.pop();\n   var json = {\"value\":msg.payload};\n \n}\n\nvar keys = [];\nvar values = [];\n\nfor(var k in json) \n{\n\tif (k[0] != \"_\") \n\t{\n\t\tkeys.push(k);\n\t\t\n\t\tif (k == \"time\")\n\t\t{\n\t\t\tvalues.push(json[k] * 1000.0);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvalues.push(json[k]);\n\t\t}\n\t}\n}\n\nmsg.payload = [\n  {\n    \"name\" : msg.topic,\n    \"columns\" : keys,\n    \"points\" :  [values]\n    \n  }\n];\n\nreturn msg;","outputs":1,"x":330,"y":448,"z":"716249cc.8e9db8","wires":[["2e582d25.d1a7d2"]]}]